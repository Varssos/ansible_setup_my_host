---
- name: Download Signal GPG key
  get_url:
    url: https://updates.signal.org/desktop/apt/keys.asc
    dest: /tmp/signal-keys.asc
    mode: '0644'

- name: Convert Signal key to apt keyring format
  command: gpg --dearmor --yes --output /usr/share/keyrings/signal-desktop-keyring.gpg /tmp/signal-keys.asc
  args:
    creates: /usr/share/keyrings/signal-desktop-keyring.gpg

- name: Download Signal repository file
  get_url:
    url: https://updates.signal.org/static/desktop/apt/signal-desktop.sources
    dest: /etc/apt/sources.list.d/signal-desktop.sources
    mode: '0644'

- name: Install signal-desktop
  apt:
    name: signal-desktop
    state: present
    update_cache: yes